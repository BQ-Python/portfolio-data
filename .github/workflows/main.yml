name: Mise à jour quotidienne des portefeuilles à 19h00 (France)

on:
  schedule:
    # 19h00 heure de France toute l'année
    - cron: '0 18 * * *'   # ← Hiver (UTC+1) → 19h00 Paris
    - cron: '0 17 * * *'   # ← Été (UTC+2) → 19h00 Paris
  workflow_dispatch:       # Permet de lancer manuellement

jobs:
  update-portfolios:
    runs-on: ubuntu-latest
    steps:
      - name: Récupérer le code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Installer Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Installer les dépendances
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Exécuter le script de mise à jour
        run: |
          scripts/update_performances.py    # ← METS ICI LE NOM EXACT DE TON SCRIPT

      - name: Commit & Push uniquement s'il y a des changements
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add .
          if git diff --staged --quiet; then
            echo "Aucune modification → pas de commit"
          else
            git commit -m "Mise à jour automatique des portefeuilles $(date -u '+%Y-%m-%d %H:%M UTC')"
            git push
            echo "Modifications poussées !"
          fi
