name: üí∞ Mise √† Jour Quotidienne des Portefeuilles
# Ce workflow s'ex√©cute √† 00:00 UTC (1h00 du matin heure de Paris en hiver)
# Le changement d'heure peut le d√©caler √† 2h00 en √©t√©.
# Il s'ex√©cute du Lundi au Vendredi (jours de bourse).
on:
  schedule:
    # Ex√©cution √† 00:00 UTC (0 0 * * *) 
    - cron: '0 0 * * 1-5' 
  
  # Permet de d√©clencher manuellement le workflow depuis l'interface GitHub
  workflow_dispatch: 

jobs:
  update_and_calculate:
    runs-on: ubuntu-latest
    
    # R√©cup√©ration du SECRET pour Firebase
    env:
      # Ceci correspond √† la variable FIREBASE_SERVICE_ACCOUNT utilis√©e dans votre code Python
      FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
    
    steps:
      - name: ‚¨áÔ∏è Checkout du code
        uses: actions/checkout@v4
        
      - name: üêç Configuration de Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          
      - name: ‚öôÔ∏è Installation des d√©pendances
        run: |
          pip install pandas numpy firebase-admin yfinance
          
      # Votre script Python est con√ßu pour lire le secret soit
      # depuis 'service-account.json' soit depuis la variable d'environnement.
      # Pour GitHub Actions, nous passons par la variable d'environnement (env).
      - name: üöÄ Ex√©cution du script de mise √† jour (01h00 CET)
        run: python votre_script.py
        
      - name: üíæ Sauvegarde du CSV mis √† jour (Optionnel)
        # Ceci est utile si vous voulez conserver le 'prices_daily.csv' mis √† jour
        # pour le prochain run (n√©cessite une petite configuration suppl√©mentaire, 
        # mais on peut le faire plus tard si besoin de persistance).
        run: echo "Le fichier prices_daily.csv a √©t√© mis √† jour localement."
