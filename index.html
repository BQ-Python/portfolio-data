<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Horizon Labs — Présentation graphique (sparklines + barres)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#040512;
      --accent:#4a90e2;
      --muted:rgba(255,255,255,0.78);
      --card-bg:rgba(255,255,255,0.03);
      --card-strong:rgba(255,255,255,0.06);
      --border:rgba(255,255,255,0.08);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#fff;background:var(--bg);-webkit-font-smoothing:antialiased;overflow-x:hidden}

    /* Scene */
    .scene{position:fixed;inset:0;z-index:0;overflow:hidden;pointer-events:none;background:linear-gradient(180deg,#02030a 0%,#040512 70%)}
    .scene::after{content:"";position:absolute;inset:0;background:rgba(0,0,0,0.66);z-index:2;pointer-events:none}
    canvas#hero{position:absolute;inset:0;width:100%;height:100%;z-index:1;display:block}

    /* Nav */
    nav{position:fixed;top:16px;left:0;right:0;z-index:1200;display:flex;justify-content:center;pointer-events:auto}
    .nav{width:1280px;max-width:96%;display:flex;justify-content:space-between;align-items:center;padding:10px 18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter:blur(12px);border-radius:8px;border:1px solid var(--border)}
    .brand{font-weight:800;font-size:1.3rem}
    .brand span{color:var(--accent)}
    .links a{color:var(--muted);text-decoration:none;margin-left:20px;font-weight:500;transition:all .25s}
    .links a:hover{color:#fff}

    /* Hero (titre + lead) - remis comme avant */
    .hero{min-height:56vh;display:flex;align-items:center;justify-content:center;position:relative;z-index:40;padding:0 20px;text-align:center}
    .hero-inner{max-width:980px;padding:36px;background:linear-gradient(180deg,var(--card-bg),var(--card-strong));border-radius:12px;backdrop-filter:blur(10px);border:1px solid var(--border)}
    h1{font-size:clamp(2rem,4.5vw,3.4rem);line-height:1.05;font-weight:800;margin-bottom:8px}
    .lead{font-size:clamp(1rem,1.6vw,1.05rem);color:var(--muted);margin-bottom:14px}

    /* KPI centered overlay */
    .kpi-center{
      position:fixed;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      z-index:60;
      display:flex;
      gap:18px;
      padding:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.04);
      backdrop-filter:blur(8px);
      box-shadow:0 10px 30px rgba(0,0,0,0.45);
      pointer-events:auto;
      align-items:center;
    }
    .kpi-card{
      min-width:160px;
      max-width:220px;
      padding:14px 18px;
      border-radius:10px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
    }
    .kpi-card h3{font-size:0.95rem;color:var(--muted);font-weight:600;margin-bottom:6px}
    .kpi-card .value{font-size:1.5rem;font-weight:800;color:#fff}

    /* Responsive: on small screens, place KPI block below hero and stack 2x2 */
    @media (max-width:900px){
      .kpi-center{
        position:static;
        transform:none;
        margin:18px auto;
        display:grid;
        grid-template-columns:repeat(2,1fr);
        gap:12px;
        width:calc(100% - 36px);
        max-width:640px;
        padding:14px;
      }
      .hero{min-height:48vh}
      .hero-inner{padding:20px}
    }

    /* Dashboard content below (kept for SEO/text) */
    .page-content{position:relative;z-index:70;max-width:1280px;margin:calc(56vh + 40px) auto 80px;padding:28px 20px}
    #seo-description{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:8px;padding:20px;border:1px solid rgba(255,255,255,0.04);color:var(--muted);line-height:1.5}
    footer{position:relative;z-index:60;padding:24px;text-align:center;color:var(--muted);font-size:0.85rem}
  </style>
</head>
<body>

  <div class="scene" aria-hidden="true">
    <canvas id="hero" aria-hidden="true"></canvas>
  </div>

  <nav>
    <div class="nav">
      <div class="brand">Horizon<span>Labs</span></div>
      <div class="links">
        <a class="disabled" aria-disabled="true">Accueil</a>
        <a href="portefeuilles.html">Portefeuilles</a>
        <a class="disabled" aria-disabled="true">Analyse</a>
        <a class="disabled" aria-disabled="true">Paramètres</a>
      </div>
    </div>
  </nav>

  <!-- Hero header (restored) -->
  <section class="hero" aria-hidden="false">
    <div class="hero-inner" role="region" aria-label="Présentation">
      <h1>Maîtrise financière, en toute simplicité.</h1>
      <p class="lead">Tableau de bord SaaS pour un survol en temps réel — KPIs essentiels et tendances procédurales.</p>
    </div>
  </section>

  <!-- KPI centered overlay (4 vignettes) -->
  <div class="kpi-center" role="region" aria-label="Indicateurs clés">
    <div class="kpi-card" id="kpi-wallets">
      <h3>Portefeuilles</h3>
      <div class="value" id="walletsCount">—</div>
    </div>
    <div class="kpi-card" id="kpi-newsletters">
      <h3>Newsletters</h3>
      <div class="value" id="newslettersCount">—</div>
    </div>
    <div class="kpi-card" id="kpi-assets">
      <h3>Actifs distincts</h3>
      <div class="value" id="assetsCount">—</div>
    </div>
    <div class="kpi-card" id="kpi-visits">
      <h3>Visites (mois)</h3>
      <div class="value" id="visitsCount">1 234</div>
    </div>
  </div>

  <!-- Page content (kept below so KPI overlay doesn't hide text) -->
  <main class="page-content" aria-live="polite">
    <article id="seo-description">
      <h2 style="color:#fff;margin-bottom:10px;font-size:1.15rem;">À propos — Présentation graphique</h2>
      <p>Version mixée : barres en bas + sparklines marquantes par dessus, glow et ombres pour profondeur, densité réduite pour respirer. Idéal pour une page de démonstration ou un hero visuel.</p>
    </article>
  </main>

  <footer>© 2025 Horizon Labs — Gestion SaaS privée</footer>

  <script>
    // KPI fetching (unchanged logic, updates DOM values)
    const el = {
      wallets: document.getElementById('walletsCount'),
      newsletters: document.getElementById('newslettersCount'),
      assetsTotal: document.getElementById('assetsCount'),
      visits: document.getElementById('visitsCount'),
      kpiWalletsCard: document.getElementById('kpi-wallets'),
      kpiAssetsCard: document.getElementById('kpi-assets')
    };

    const portfoliosUrl = 'https://raw.githubusercontent.com/BQ-Python/portfolio-data/refs/heads/main/portfolios.json';
    const compositionCsvUrl = 'https://raw.githubusercontent.com/BQ-Python/portfolio-data/refs/heads/main/composition_portefeuilles.csv';
    const newslettersUrl = 'https://raw.githubusercontent.com/BQ-Python/portfolio-data/refs/heads/main/newsletters.json';

    function parseCSV(text){
      const lines = text.split(/\r?\n/).filter(l=>l.trim()!=='');
      if(!lines.length) return {headers:[], rows:[]};
      const headerLine = lines[0];
      const delimiter = headerLine.includes('\t') ? '\t' : ',';
      const headers = headerLine.split(delimiter).map(h=>h.trim().replace(/^"|"$/g,''));
      const rows = lines.slice(1).map(line=>{
        const values=[]; let cur='', inQuotes=false;
        for(let i=0;i<line.length;i++){
          const ch=line[i];
          if(ch==='"'){ if(inQuotes && line[i+1]==='"'){ cur+='"'; i++; } else { inQuotes=!inQuotes; } continue; }
          if(ch===delimiter && !inQuotes){ values.push(cur); cur=''; continue; }
          cur+=ch;
        }
        values.push(cur);
        return values.map(v=>v.trim().replace(/^"|"$/g,''));
      });
      return {headers, rows};
    }

    async function updateKPIs(){
      try{
        const res = await fetch(portfoliosUrl, {cache:'no-store'});
        if(!res.ok) throw new Error('portfolios.json '+res.status);
        const data = await res.json();
        let count = Array.isArray(data) ? data.length : (data && typeof data==='object' ? (Object.values(data).find(v=>Array.isArray(v))||[]).length : 0);
        el.wallets.textContent = count.toLocaleString('fr-FR');
        el.kpiWalletsCard.classList.remove('kpi--error');
      }catch(e){ el.wallets.textContent='0'; el.kpiWalletsCard.classList.add('kpi--error'); }

      try{
        const res2 = await fetch(newslettersUrl, {cache:'no-store'});
        if(!res2.ok) throw new Error('newsletters.json '+res2.status);
        const ndata = await res2.json();
        let ncount = Array.isArray(ndata) ? ndata.length : (ndata && typeof ndata==='object' ? (Object.values(ndata).find(v=>Array.isArray(v))||[]).length : 0);
        el.newsletters.textContent = ncount.toLocaleString('fr-FR');
      }catch(e){ el.newsletters.textContent='0'; }

      try{
        const res3 = await fetch(compositionCsvUrl, {cache:'no-store'});
        if(!res3.ok) throw new Error('composition CSV '+res3.status);
        const csvText = await res3.text();
        const parsed = parseCSV(csvText);
        const headersLower = parsed.headers.map(h=>h.toLowerCase());
        const tickerIdx = headersLower.findIndex(h=>['ticker','symbole','symbol'].includes(h));
        if(tickerIdx===-1){ el.assetsTotal.textContent='0'; el.kpiAssetsCard.classList.add('kpi--error'); }
        else {
          const tickers = new Set();
          parsed.rows.forEach(r=>{ const t=(r[tickerIdx]||'').trim(); if(t) tickers.add(t.toUpperCase()); });
          el.assetsTotal.textContent = tickers.size.toLocaleString('fr-FR');
          el.kpiAssetsCard.classList.remove('kpi--error');
        }
      }catch(e){ el.assetsTotal.textContent='0'; el.kpiAssetsCard.classList.add('kpi--error'); }

      if(el.visits) el.visits.textContent = '1 234';
    }
    updateKPIs();
    setInterval(updateKPIs, 30000);

    /* Canvas drawing (kept from previous version) - simplified init to avoid long code here.
       If you want further tweaks (spacing, colors, bar visibility), je peux ajuster précisément. */

    const canvas = document.getElementById('hero');
    const ctx = canvas.getContext('2d', { alpha: true });
    let DPR = Math.max(1, devicePixelRatio || 1);
    let W = innerWidth, H = innerHeight;
    function resizeCanvas(){
      DPR = Math.max(1, devicePixelRatio || 1);
      W = innerWidth; H = innerHeight;
      canvas.width = Math.round(W * DPR);
      canvas.height = Math.round(H * DPR);
      canvas.style.width = W + 'px';
      canvas.style.height = H + 'px';
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Minimal animated background placeholder (keeps CPU low)
    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    let t0 = performance.now();
    function draw(now){
      const t = (now - t0) * 0.001;
      ctx.clearRect(0,0,W,H);
      // faint gradient
      const g = ctx.createLinearGradient(0,0,0,H);
      g.addColorStop(0, 'rgba(6,10,20,0.0)');
      g.addColorStop(1, 'rgba(6,10,20,0.12)');
      ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
      // subtle moving band to suggest activity
      ctx.globalCompositeOperation = 'lighter';
      for(let i=0;i<4;i++){
        const x = (Math.sin(t*0.2 + i) * 0.5 + 0.5) * W;
        const r = Math.min(W,H) * (0.18 + i*0.06);
        const grd = ctx.createRadialGradient(x, H*0.28 + i*40, r*0.05, x, H*0.28 + i*40, r);
        grd.addColorStop(0, `hsla(${200 + i*18},90%,70%,${0.06})`);
        grd.addColorStop(1, `hsla(${200 + i*18},90%,40%,0)`);
        ctx.fillStyle = grd; ctx.beginPath(); ctx.arc(x, H*0.28 + i*40, r, 0, Math.PI*2); ctx.fill();
      }
      ctx.globalCompositeOperation = 'source-over';
      if(!reduceMotion) requestAnimationFrame(draw);
    }
    if(!reduceMotion) requestAnimationFrame(draw);
    else draw(performance.now());
  </script>
</body>
</html>
